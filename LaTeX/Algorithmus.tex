\chapter{Der Netzwerk-Simplex-Algorithmus}\label{ch:NSA}
Zunächst führen wir in \cref{ch:MCF} das Transportproblem und dessen Verallgemeinerung auf beschränkte Kapazitäten ein. Weiterhin geben wir die Einschränkungen an, auf denen insbesondere der Programmierteil dieser Bachelorarbeit fußt. Die \cref{ch:BL,ch:alg} orientieren sich zuerst an \cite[S. 291\,ff.]{NSAbook} für die Beschreibung des Netzwerk-Simplex-Algorithmus zur Lösung des Transportproblems, danach wird in \cref{ch:alg2} der Algorithmus anhand von \cite[S. 353\,ff.]{NSAbook} auf den allgemeinen Fall erweitert.

Wir werden im Folgenden nur endliche Graphen betrachten. Außerdem sind alle Graphen einfach, das heißt, sie weisen weder mehrfache Kanten noch Schleifen auf. Der später eingeführte Residualgraph wird ebenfalls keine Schleifen besitzen, doppelte Kanten können unter Umständen vorkommen.

\section{Min-Cost-Flow-Problem}\label{ch:MCF}
\begin{defn}Ein \textbf{Netzwerk} ist ein Tupel $(G,b,c,u)$ bestehend aus einem gerichteten Graphen $G = (V,E)$ und den Abbildungen $b \colon V\rightarrow\mathbb{R}$, $c \colon E\rightarrow\mathbb{R}$ sowie $u \colon E\rightarrow\mathbb{R}_{\geq 0}\cup \{\infty\}$. Wir bezeichnen $b$ als \emph{b-Wert-Funktion}, $c$ als \emph{Kostenfunktion} und $u$ als \emph{Kapazitätsfunktion}.\end{defn}
\begin{anm}Ein ungerichteter Graph kann durch das Verwandeln jeder Kante $\{v,w\}$ in zwei Kanten $(v,w)$ und $(w,v)$ zu einem gerichteten modifiziert werden. Knoten mit positivem b-Wert werden als \emph{Quellen}, solche mit negativem als \emph{Senken} bezeichnet. Knoten mit neutralem b-Wert werden \emph{Transitknoten} genannt.\end{anm}

\begin{defn}\label{DefMaxFlow}Ein \textbf{maximaler Fluss} auf einem Netzwerk $(G=(V,E),b,c,u)$ ist eine Abbildung $f \colon E\rightarrow\mathbb{R}_{\geq 0}$, die folgende Eigenschaften erfüllt:
\begin{alignat}{3}
&\text{(i)}\quad&&\forall e\in E &&\colon f(e)\leq u(e)\nonumber\\
&\text{(ii)}\quad&&\forall v\in V &&\colon \sum_{\mathclap{(w,v)\in E}} f((w,v)) - \sum_{\mathclap{(v,w)\in E}} f((v,w)) + b(v) = 0\label{DefMaxFlowII}
\end{alignat}
Die \emph{Kosten} von $f$ betragen $c(f) = \sum\limits_{\mathclap{e\in E}} f(e)\cdot c(e)$.
\end{defn}

\begin{defn}Sei $N=(G,b,c,u)$ ein Netzwerk. Als \textbf{Min-Cost-Flow-Problem} bezeichnen wir die Suche nach einem maximalen Fluss $f$ auf $N$ mit minimalen Kosten. Die vereinfachte Version mit unbeschränkter Kapazitätsfunktion, bei der $u(e)=\infty$ für alle $e\in E(G)$ gilt, nennen wir \textbf{Transportproblem}.\end{defn}

In dieser Bachelorarbeit wird angenommen, dass $b$ auf $\mathbb{Z}$ sowie $c$ und $u$ auf $\mathbb{N}_{\geq0}$ abbilden, um Gleitkommazahlungenauigkeit beim Programmieren zu vermeiden. Durch eine entsprechende Skalierung des Problems können Funktionen nach $\mathbb{R}$ bzw. $\mathbb{R}_{\geq 0}$ hinreichend genau angenähert werden. Es wird davon ausgegangen, dass die b-Werte der Quellen und Senken ausgeglichen sind, also $\sum_{v\in V(G)} b(v) = 0$ gilt. Sollte die Summe über die Senken überwiegen, ist die Instanz unlösbar. Der umgekehrte Fall kann durch eine Dummy-Senke\footnotemark{} abgefangen werden.

\footnotetext{Gemäß \cite[S. 454]{LP&NF2010} fügen wir $G$ eine zusätzliche Senke $s$ hinzu, die mit allen Quellen $q_i$ über eine Kante $e_i=(q_i,s)$ verbunden ist und einen b-Wert von $b(s)=-\sum_{v\in V(G)} b(v)$ zugewiesen bekommt. Für die neuen Kanten gilt $c(e_i)=0$ und $u(e_i)=\infty$.}

Da die Kostenfunktion auf nicht-negative Werte eingeschränkt ist, hat kein maximaler Fluss negative Kosten und unbeschränkte Instanzen sind ausgeschlossen. Unbeschränkte Kapazitäten können somit in der konkreten Implementierung durch $1+0,5\cdot\sum_{v\in V} |b(v)|$ abgeschätzt werden, ohne dass die Lösungsmenge verändert wird. Alle Netzwerke werden als zusammenhängend angenommen, da die Zusammenhangskomponenten einer Instanz separat gelöst werden können. Der implementierte Algorithmus verlangt keinen Zusammenhang.

\section{Zulässige Baumlösungen}\label{ch:BL}
Um die Funktionsweise des Netzwerk-Simplex-Algorithmus zu beschreiben, benötigen wir zunächst einige grundlegende Definitionen der Graphentheorie. Im Nachfolgenden sind die wichtigsten in Kürze aufgeführt, für eine vollständige Einführung sei der geneigte Leser auf \cite{Alma} verwiesen.

\begin{defn}Der einem gerichteten Graphen $G=(V,E)$ \textbf{zugrundeliegende ungerichtete Graph} $G'=(V,E')$ ist definiert durch:
\begin{equation*}\{v,w\}\in E' \iff (v,w) \in E \lor (w,v) \in E\end{equation*} \end{defn}
\begin{anm}Dieser Definition zufolge bleibt der zugrundeliegende Graph einfach. Eine gängige Alternative entfernt nur die Orientierung aller Kanten, dies ist für unsere Zwecke jedoch nicht praktikabel.\end{anm}

\begin{defn}Ein \textbf{Baum} $T$ ist ein ungerichteter, zusammenhängender und kreisfreier Graph. Ein \textbf{Wald} ist ein Graph, bei dem jede Zusammenhangskomponente ein Baum ist. Ein Teilgraph $T=(V',E')$ eines ungerichteten Graphen $G=(V,E)$ heißt \textbf{aufspannender Baum}, wenn T ein Baum und $V'=V$ ist.\end{defn}

\begin{anm}Bezeichnen wir einen gerichteten Graphen $G$ als Wald oder Baum, so bezieht sich das auf den $G$ zugrundeliegenden ungerichteten Graphen. Ein aufspannender Baum von $G$ ist ein Teilgraph $T$ von $G$, dessen zugrundeliegender ungerichteter Graph ein aufspannender Baum des $G$ zugrundeliegenden ungerichteten Graphen ist.\end{anm}

\begin{defn}Sei $N=(G,b,c,u)$ eine Instanz des Transportproblems. Ein aufspannender Baum $T$ von $G$ und ein maximaler Fluss $f$ auf $N$ bilden eine \textbf{zulässige Baumlösung} $(T,f)$, falls für alle Kanten $e\in E(G)\backslash E(T)$ außerhalb des Baumes $f(e) = 0$ gilt.\end{defn}

\begin{nota}Sei $G=(V,E)$ ein Graph und $V'\subseteq V$ eine Teilmenge der Knoten. Der von V' \emph{induzierte Teilgraph} $G[V']=(V',E')$ mit $E'=\{(v,w)\in E\mid v\in V'\land w\in V'\}$ enthält die Knoten aus $V'$ und alle Kanten zwischen ihnen, die schon in $E$ vorhanden waren.\end{nota}

%bug with restatable, see https://tex.stackexchange.com/questions/111639/extra-spacing-around-restatable-theorems
\vspace{-1.9ex}
\begin{restatable}{lem}{TreeUnique}\label{TreeUnique}Jede zulässige Baumlösung $(T,f)$ ist eindeutig durch den aufspannenden Baum $T$ definiert.\end{restatable}
\begin{proof}Sei $(T,f)$ eine zulässige Baumlösung einer Instanz des Transportproblems. Wir führen eine Induktion über die Anzahl der Knoten des Baumes durch. Die zulässige Baumlösung zum leeren Baum ist offensichtlich eindeutig.

Für jedes Blatt $l\in V(T)$ sei $e_l\in E(T)$ die Kante in $T$ zwischen dem Knoten $l$ und seinem eindeutigen Nachbarknoten $k_l$. Für alle Blätter $l$ ist der Wert $f(e_l)$ nach \cref{DefMaxFlowII} eindeutig. Wir betrachten nun die eingeschränkte Knotenmenge $V'=\{v\in V(T)\mid v\text{ ist kein Blatt in }T\}$. Da jeder nichtleere Baum mindestens ein Blatt besitzt, ist $|V'|<|V(T)|$. Sei $T'=T[V']\subsetneq T$ der durch $V'$ induzierte Teilgraph von $T$. Damit ist $T'$ ein Baum und $E(T')$ sind genau die Kanten, für die $f$ noch nicht bestimmt wurde.

Sei $N'=(G'=G[V'],b',c_{|E(G')},u_{|E(G')})$ das auf $V'$ eingeschränkte Netzwerk $N$ mit der folgendermaßen angepassten b-Wert-Funktion $b'$, bei der nur die b-Werte von Blattnachbarn bezogen auf Blätter in $T$ angepasst werden:
\begin{equation}\label{eq:newB}
\forall v'\in V'\colon\quad b'(v')=b(v')+\sum_{\substack{l\in V(T)\backslash V':\\(l,v')\in E(T)}} b(l)-\sum_{\substack{l\in V(T)\backslash V':\\(v',l)\in E(T)}} b(l)\end{equation}

Wir nehmen per Induktion an, dass wir für den aufspannenden Baum $T'$ von $G'$ einen eindeutigen Fluss $f'$ erhalten, und setzen für alle Kanten $e\in E(T')$ den Fluss $f(e):=f'(e)$. Nach \cref{eq:newB} ist $f$ ein maximaler Fluss auf $N$, außerdem ist $f$ nach Konstruktion eindeutig.\end{proof}

\begin{figure}[!ht]\centering
    \includestandalone{tikz_BL}
    \caption{Links ein maximaler Fluss ohne zulässige Baumlösung, rechts ein maximaler Fluss mit mehreren zulässigen Baumlösungen.}
    \label{fig:BL}
\end{figure}

Wie \cref{fig:BL} a) veranschaulicht, existiert nicht zwingend ein Baum $T$ zu einem Fluss $f$; die Gegenrichtung von \cref{TreeUnique} gilt also nicht. Graph b) zeigt, dass auch bei Beschränkung auf maximale Flüsse mit zulässiger Baumlösung der Baum nicht eindeutig ist.

Wie wir in \cref{TP} zeigen werden, existiert für das Min-Cost-Flow-Problem immer eine Lösung, die auch eine zulässige Baumlösung ist. Die dem Algorithmus zugrundeliegende Idee ist, über die Bäume zulässiger Baumlösungen mit sinkenden Kosten zu iterieren. Der Übergang basiert dabei auf dem Augmentieren negativer Kreise, eine Methode, für die das Konzept des Residualnetzwerks hilfreich ist.

\begin{defn}\label{defRes}Sei $N=(G=(V,E),b,c,u)$ ein Netzwerk mit einem maximalen Fluss $f$. Die \textbf{Residualkante} $\bar{e}$ einer Kante $e=(v,w)\in E$ verläuft von $w$ nach $v$. Sei $\bar{E}=\{\bar{e}\mid e\in E\}$ die Menge aller Residualkanten. Die \textit{Residualkapazität} $u_f\colon\bar{E}\rightarrow\mathbb{N}_{\geq0}$ ist bestimmt durch $u_f(\bar{e})=f(e)$, die \textit{Residualkosten} $c_f\colon\bar{E}\rightarrow\mathbb{Z}$ durch $c_f(\bar{e})=-c(e)$.

Das \textbf{Residualnetzwerk} $R$ ist ein Tupel $R_{N,f}=(\bar{G}=(V,E\amalg\bar{E}),\bar{f},b,\bar{c},\bar{u})$ mit dem \emph{Residualgraph} genannten gerichteten Multigraphen $\bar{G}$ aus der bisherigen Knotenmenge und der disjunkten Vereinigung von Kanten und Residualkanten, dem maximalen Fluss $\bar{f}$ mit $\bar{f}(e)=f(e)$ für alle $e\in E$ und $\bar{f}(\bar{e})=0$ für alle $\bar{e}\in\bar{E}$, der b-Wert-Funktion $b$ wie gehabt, der Kostenfunktion $\bar{c}=c\amalg c_f\colon E\amalg\bar{E}\rightarrow\mathbb{Z}$ und der Kapazitätsfunktion $\bar{u}=u\amalg u_f\colon E\amalg\bar{E}\rightarrow\mathbb{N}_{\geq0}\cup \{\infty\}$.\end{defn}

\begin{nota}Mit $\varphi\colon E\leftrightarrow\bar{E}$ bezeichnen wir in einem Residualnetzwerk die kanonische Bijektion zwischen den Kanten und ihren Residualkanten. Außerdem seien für einen beliebigen Graph $G'=(V',E')$ die Kosten $c(G'):=\sum_{e\in E'} c(e)$ als die Summe der Kosten der einzelnen Kanten definiert.\end{nota}

Wenn wir in einem Residualnetzwerk $R_{N,f}$ den Fluss einer Residualkante $\bar{e}$ um $0\leq\delta\leq u_f(\bar{e})$ erhöhen, so wird in Wirklichkeit der Fluss $f(\varphi(\bar{e}))$ um $\delta$ reduziert. Nach obiger Definition ist sichergestellt, dass $f(\varphi(\bar{e}))-\delta\geq0$.

Verändern wir den maximalen Fluss $f$ auf nur einer Kante, so ist die resultierende Funktion $f'$ kein maximaler Fluss mehr. Deswegen werden wir stattdessen gerichtete Kreise $C$ im Residualgraph $\bar{G}$ zu einer Abbildung $f'$ augmentieren, das heißt, wir erhöhen den Fluss auf allen Kanten $e\in E(C)$ um einen festen Betrag $\delta\in\mathbb{N}_{\geq0}$, ohne dabei Kapazitätsschranken zu verletzen. Damit ist \cref{DefMaxFlowII} für maximale Flüsse weiterhin erfüllt:
\begin{alignat*}{4}
\forall v\in V(C)\colon&&&\sum_{\mathclap{(w,v)\in E(G)}} f'((w,v)) &&-\sum_{\mathclap{(v,w)\in E(G)}} f'((v,w)) &&+ b(v)\\
&=\quad&&\sum_{\mathclap{(w,v)\in E(G)}} f((w,v)) + \delta &&-\sum_{\mathclap{(v,w)\in E(G)}} f((v,w)) - \delta &&+ b(v) = 0\end{alignat*}
Also ist $f'$ ein maximaler Fluss. Seine Kosten betragen $c(f')=c(f) + \delta\cdot c(C)$.

\begin{lem}\label{negKreis}Sei $N$ eine Instanz des Transportproblems, $R_{N,f}$ ihr Residualnetzwerk und $C$ ein gerichteter Kreis im Residualgraph $\bar{G}$ mit negativen Kosten. Dann ist der größte Wert $\delta$, um den $C$ augmentiert werden kann, endlich, und nach der Augmentierung um $\delta$ zum neuen maximalen Fluss $f'$ existiert eine Residualkante $\bar{e}\in E(C)$, sodass die korrespondierende Kante einen Fluss von $f'(\varphi(\bar{e}))=0$ besitzt. 
\end{lem}
\begin{proof}Sei $N=(G,b,c,u)$ eine Instanz des Transportproblems mit maximalen Fluss $f$ und $C$ ein negativer Kreis in $\bar{G}$. Wir setzen $\delta:=\min_{e\in E(C)}\{\bar{u}(e)-\bar{f}(e)\}$. Da $c\colon E(G)\rightarrow\mathbb{N}_{\geq0}$ in die natürlichen Zahlen abbildet, enthält jeder negative Kreis in $\bar{G}$ mindestens eine Residualkante $\bar{e}$. Damit ist $0\leq\delta\leq u_f(\bar{e})<\infty$.

Wir haben $\delta$ unter allen zulässigen Werten größtmöglich gewählt. Da alle Kanten $e\in E(G)$ unbeschränkte Kapazität haben und ihr Fluss $f(e)$ endlich ist, gibt es eine Residualkante $\bar{e}$ mit $u_f(\bar{e})=\delta$. Nachdem wir $C$ um $\delta$ zu einem maximalen Fluss $f'$ augmentiert haben, gilt für die korrespondierende Kante $e:=\varphi(\bar{e})$:
\begin{equation*}
f'(e)=f(e)-\delta=f(e)-u_f(\bar{e})=f(e)-f(e)=0.\qedhere
\end{equation*}\end{proof}

\begin{nota}Sei $f$ ein maximaler Fluss für ein Netzwerk $(G=(V,E),b,c,u)$ und $H=(V'\subseteq V, E'\subseteq E)$ ein Teilgraph von $G$. Mit $H_f=(V',\{e\in E' \mid f(e) \neq 0\})$ bezeichnen wir den Graph aller durchflossenen Kanten von $H$.\end{nota}

Dank \cref{negKreis} wissen wir, dass nach maximaler Augmentierung eines negativen Kreises $C$ alle seine durchflossenen Kanten $C_f$ einen Wald bilden. Damit können wir nun zeigen, dass eine zulässige Baumlösung $(T,f)$ mit einem maximalen Fluss $f$ minimaler Kosten existiert.

\begin{thm}\label{BLex}Sei $N$ eine Instanz des Transportproblems mit einem maximalen Fluss $f$. Es existiert ein maximaler Fluss $\hat{f}$, sodass $c(\hat{f})\leq c(f)$ ist und eine zulässige Baumlösung $(\hat{T},\hat{f})$ existiert.\end{thm}
\begin{proof}Sei $N=(G,b,c,u)$ eine Instanz des Transportproblems mit maximalen Fluss $f$. Wir werden $f$ schrittweise zu einem maximalen Fluss $\hat{f}$ umwandeln, sodass $G_{\hat{f}}$ ein Wald ist. Für $\hat{f}$ lässt sich dann leicht eine zulässige Baumlösung finden. Wenn wir für die endlich vielen maximalen Zwischenflüsse $f=f_0,f_1,f_2,\ldots,f_n=\hat{f}$ sicherstellen, dass $c(f_{i+1})\leq c(f_i)$ ist, gilt auch $c(\hat{f})\leq c(f)$.

Betrachte einen maximalen Fluss $f_i$. Wenn $G_{f_i}$ ein Wald ist, setzen wir $\hat{f}:=f_i$ und sind fertig. Ansonsten gibt es einen ungerichteten Kreis $C\subseteq G_{f_i}$. Betrachte die beiden dazugehörigen, gerichteten, kantendisjunkten Kreise $C_1$ und $C_2$ in $R_{N,f_i}$. Nach \cref{defRes} gilt $c(C_1)=-c(C_2)$. Wir werden einen der Kreise so augmentieren, dass $|E(G_{f_{i+1}})|<|E(G_{f_i})|$ ist.
\begin{itemize}[leftmargin=!,labelwidth=\widthof{Fall 1:}]
\item[Fall 1:] $c(C_1)=0$\\
	Mindestens einer der beiden Kreise enthält eine Residualkante, sei dies \obda $C_1$. Augmentiere nun $C_1$ analog zum Beweis von \cref{negKreis} größtmöglich zu einem maximalen Fluss $f_{i+1}$. Damit ist $C\nsubseteq G_{f_{i+1}}$ und $c(f_{i+1}) = c(f_i)$.
\item[Fall 2:] $c(C_1)\neq0$\\
	\Obda sei $c(C_1)<0$. Nach \cref{negKreis} erhalten wir einen maximalen Fluss $f_{i+1}$, sodass $C\nsubseteq G_{f_{i+1}}$ und $c(f_{i+1}) = c(f_i) + \delta\cdot c(C_1)<c(f_i)$.
\end{itemize}

Damit ist $G_{f_{i+1}}\subsetneq G_{f_i}$ sowie $c(f_{i+1})\leq c(f_i)$. Nach endlich vielen Iterationen erhalten wir somit ein kreisfreies $G_{f_j}$, dann sei $\hat{f}:=f_j$.
\end{proof}

\begin{kor}\label{TP}Für jede lösbare Instanz des Transportproblems existiert eine zulässige Baumlösung $(T,f)$, sodass der maximale Fluss $f$ minimale Kosten hat.\qed\end{kor}

\begin{nota}Sei $N=(G,b,c,u)$ ein Netzwerk mit maximalen Fluss $f$, $T$ ein aufspannender Baum von $G$, $R_{N,f}=(\bar{G},\bar{f},b,\bar{c},\bar{u})$ das Residualnetzwerk und $e\in E(\bar{G})\backslash E(T)$ eine weitere Kante. Mit $C_{T,e}$ bezeichnen wir den eindeutigen Teilgraph von $T\cup\{e\}$, dessen zugrundeliegender Graph ein Kreis ist, und mit $\bar{C}_{T,e}$ den $C_{T,e}$ eindeutig zugeordneten gerichteten Kreis im Residualgraph $\bar{G}$, der $e$ enthält.\end{nota}

\section{Der grundlegende Algorithmus}\label{ch:alg}

Sei $N=(G,b,c,u)$ eine Instanz des Transportproblems. Wie beim Simplex-Algorithmus gibt es beim Netzwerk-Simplex-Algorithmus zwei Phasen. In der ersten wird eine initiale zulässige Baumlösung $(T_0,f_0)$ auf $N$ erzeugt; die beiden etablierten Vorgehensweisen werden in \cref{ch:init} beschrieben. Die Problematik einer Instanz ohne Lösung wird ebenfalls dort behandelt.

In der zweiten Phase wird folgende Vorgehensweise iteriert: Betrachte Iteration $i$ mit zulässiger Baumlösung $(T_i,f_i)$. Wähle einen negativen Kreis $\bar{C}_{T,e}$, wobei $e\in E(G)\backslash E(T)$ eine Nichtbaumkante ist. Existiert kein solcher, beende den Algorithmus. Andernfalls augmentiere $\bar{C}_{T,e}$ größtmöglich zum maximalen Fluss $f_{i+1}$; dann existiert nach \cref{negKreis} eine Kante $e'\in E(C_{T,e})$ mit $e\neq e'$ und $f_{i+1}(e')=0$. Die neue zulässige Baumlösung ist dann $(T_i\backslash\{e'\}\cup\{e\},f_{i+1})$. Die verschiedenen Möglichkeiten zur Wahl von $e'$ und $e$ werden in \cref{ch:deg} und \cref{ch:pivot} näher beleuchtet.

\begin{restatable}{thm}{Opt}\label{opt}Sei $N$ eine Instanz des Transportproblems mit einer zulässigen Baumlösung $(T,f)$. Existiert kein negativer Kreis $\bar{C}_{T,e}$, so ist $f$ eine optimale Lösung.\end{restatable}

Wir werden nun auf den Beweis von \cref{opt} hinarbeiten. Dieses sagt aus, dass der Algorithmus eine optimale Lösung des Transportproblems gefunden hat, wenn Phase 2 in Ermangelung einer geeigneten Kante $e$ beendet wird. \cref{iterierbar} ist allgemeiner formuliert als notwendig, da wir in \cref{ch:alg2} darauf zurückgreifen werden.

\begin{nota}Sei $N=(G,b,c,u)$ ein Netzwerk mit einem maximalen Fluss $f$, $T$ ein Baum von $G$ und $v,w\in V(T)$ zwei beliebige Knoten von $T$. Mit $v\xrightarrow{T}w$ bezeichnen wir den eindeutigen gerichteten Weg von $v$ nach $w$ im Residualgraph $\bar{G}$, der nur über Kanten $e\in E(T)$ oder deren Residualkanten $\varphi(e)$ verläuft. Insbesondere ist dieser Weg unabhängig von $f$ und für die Kosten gilt $c(w\xrightarrow{T}v) = -c(v\xrightarrow{T}w)$.\end{nota}

\begin{lem}\label{iterierbar}Sei $N=(G,b,c,u)$ ein Netzwerk mit einer zulässigen Baumlösung $(T,f)$ und $C$ ein ungerichteter Kreis in $G$, sodass für einen korrespondierenden gerichteten Kreis $\bar{C}$ im Residualgraph $\bar{G}$ gilt:
\begin{enumerate}[(i)]
	\item $c(\bar{C})<0$\label{negativ}
	\item $\forall e\in E(C)\backslash E(T) \colon$ die korrespondierende Kante $\bar{e}\in E(\bar{C})$ darf vom Netzwerk-Simplex-Algorithmus bei zulässiger Baumlösung $(T,f)$ als eingehende Kante gewählt werden\label{wählbar}
\end{enumerate}
Dann existiert eine vom Algorithmus wählbare Kante $\bar{e}\in\bar{C}$, sodass $c(\bar{C}_{T,\bar{e}})<0$.
\end{lem}
\begin{proof}Sei $N$ ein Netzwerk, $(T,f)$ eine zulässige Baumlösung sowie $C$ und $\bar{C}$ Kreise wie gefordert. Sei $E_{\bar{C},\neg T}\subseteq E(\bar{C})$ die Menge der zu den Nichtbaumkanten $E(C)\backslash E(T)$ korrespondierenden Kanten in $\bar{C}$ und $E_{\bar{C},T}=E(\bar{C})\backslash E_{\bar{C},\neg T}$ dessen Komplement. Betrachten wir zunächst den Fall, dass $E_{\bar{C},T}=\emptyset$:

\begin{figure}[!ht]\centering
	\includestandalone{tikz_nontreecircle}
	\caption{Die durchgezogenen Kanten bilden den negativen Kreis $\bar{C}$. Jede Kante $(v,w)\in E(\bar{C})$ wird über $w\xrightarrow{T}v$ zu einem Kreis ergänzt.}
	\label{fig:NTC}
\end{figure}

Nach \cref{wählbar} gibt es für jede Kante $e_i\in E_{\bar{C},\neg T}=E(\bar{C})$ einen Kreis $\bar{C}_{T,e_i}$. Wie \cref{fig:NTC} veranschaulicht, können wir einen Kreis $\bar{C}_{T,e_i}$ auch erzeugen, indem wir jede Kante $e_j=(v_j,w_j)\in E(\bar{C})$ mit $j\neq i$ durch den Weg $v_j\xrightarrow{T}w_j$ ersetzen und dabei in beide Richtungen begangene Kanten entfernen. Für ein $j$ verändern sich die Kosten dabei um $c(v_j\xrightarrow{T}w_j)-c(e_j)=-c(\bar{C}_{T,e_j})$, womit insgesamt gilt:

\begin{align}
c(\bar{C}_{T,e_i})=c(\bar{C})-\sum_{j\neq i} c(\bar{C}_{T,e_j})
\quad\Leftrightarrow\quad\sum_{i=1}^{|E(\bar{C})|} c(\bar{C}_{T,e_i})=c(\bar{C})\label{eq:CircleCost}
\end{align}

Nach \cref{eq:CircleCost} muss mindestens ein Kreis $\bar{C}_{T,e_i}$ negative Kosten besitzen, da $c(\bar{C})<0$ ist. Damit ist die Aussage gezeigt.

Kommen wir zum Fall $E_{\bar{C},T}\neq\emptyset$. Da $T$ ein Baum ist, ist auch $E_{\bar{C},\neg T}\neq\emptyset$. Sollte $|E_{\bar{C},\neg T}|=1$ sein, ist $\bar{C}$ der gesuchte Kreis. Ansonsten werden wir $\bar{C}$ iterativ derart zu einem Kreis $\hat{C}$ verändern, dass $E_{\hat{C},\neg T}\subsetneq E_{\bar{C},\neg T}$ und $|E_{\hat{C},\neg T}|=1$. Besitzt $\hat{C}$ negative Kosten, sind wir ebenfalls fertig, andernfalls werden wir bereits vorher einen negativen Kreis $\bar{C}_{T,e}$ mit $e\in E_{\bar{C},\neg T}$ gefunden haben.

\begin{figure}[!ht]\centering
	\includestandalone{tikz_treecircleiter}
	\caption{Gestrichelte Linien sind zum unvollständig dargestellten Baum $T$ assoziiert. Der neue Kreis $C_1$ entsteht hier, indem wir von $x$ beginnend entgegen $\tilde{C}$ bis $z$ gehen und dann dem bisherigen Kreisverlauf $\bar{C}$ folgen.}
	\label{fig:TC}
\end{figure}

Betrachte einen Iterationsschritt mit negativen Kreis $\bar{C}$, sodass $|E_{\bar{C},\neg T}|>1$ gilt. Sei $e=(x,y)\in E_{\bar{C},\neg T}$ eine beliebige Nichtbaumkante. Wir betrachten nun den Kreis $\tilde{C}:=\bar{C}_{T,e}=y\xrightarrow{T}x\cup\{(x,y)\}$ und den Kantenzug $W:=x\xrightarrow{T}y\xrightarrow{\bar{C}-\{e\}}x$. Letzterer zerfällt -- bereinigt um in beide Richtungen begangene Kanten -- in kantendisjunkte Kreise $C_1,\ldots,C_w$ mit $c(W)=\sum_{i=1}^{c} c(C_i)$. \Obda sei der Knoten $x$ in $C_1$ enthalten.

Sollten die Kosten $c(\tilde{C})<0$ negativ sein, ist $\tilde{C}$ nach \cref{wählbar} der gesuchte Kreis. Ist einer der Kreise $C_2,\ldots,C_c$ negativ, ersetzen wir $\bar{C}$ durch diesen Kreis. Andernfalls gilt für den Kreis $C_1$:
\begin{alignat*}{2}
&\bullet\quad&&|E_{C_1,\neg T}|<|E_{\bar{C},\neg T}|\\
&\bullet\quad&&c(C_1)=c(\bar{C})-c(\tilde{C})-\sum_{i=2}^{c}c(C_i)\leq c(\bar{C})<0
\end{alignat*}

Damit können wir $\bar{C}:=C_1$ setzen. In beiden Fällen ist $|E_{\bar{C},\neg T}|$ im Vergleich zum Anfang der Iteration echt kleiner geworden. Wir iterieren weiter, bis $|E_{\bar{C},\neg T}|=1$ ist; dann ist $\hat{C}:=\bar{C}$ der gesuchte Kreis.\end{proof}

Um unser gewünschtes \cref{opt} zu zeigen, genügt es, einen negativen Kreis gemäß \cref{iterierbar} zu finden. Dafür werden wir den Begriff der Zirkulation einführen und den Zusammenhang zwischen maximalen Flüssen und Zirkulationen herstellen.

\begin{defn}\label{zirk}Sei $R_{N,f}= (\bar{G},\bar{f},b,\bar{c},\bar{u})$ ein Residualnetzwerk. Eine \textbf{Zirkulation} auf $R_{N,f}$ ist eine Abbildung $z \colon E(\bar{G})\rightarrow\mathbb{N}_{\geq0}$, die folgende Eigenschaften erfüllt:
\begin{alignat}{3}
&\text{(i)}\quad&&\forall e\in E(\bar{G}) &&\colon z(e)\leq \bar{u}(e)\label{zirkI}\\
&\text{(ii)}\quad&&\forall v\in V(\bar{G}) &&\colon \sum_{\mathclap{(w,v)\in E(\bar{G})}} z((w,v)) - \sum_{\mathclap{(v,w)\in E(\bar{G})}} z((v,w)) = 0\label{zirkII}
\end{alignat}
Die \emph{Kosten} von $z$ betragen $c(z) = \sum\limits_{\mathclap{e\in E(\bar{G})}} z(e)\cdot \bar{c}(e)$.
\end{defn}
\begin{anm}Zirkulationen sind an sich für beliebige gerichtete Graphen mit einer Kapazitätsfunktion definierbar, für unsere Zwecke genügt die obige Version. Die Notation $\bar{G}_z$ für den Graph der durchflossenen Kanten überträgt sich.\end{anm}

\begin{lem}\label{zerl}Jede Zirkulation $z$ auf einem Residualnetzwerk $(\bar{G},\bar{f},b,\bar{c},\bar{u})$ zerfällt in eine endliche Menge $\mathscr{Z}=\{z_1,\ldots,z_n\}$ von Zirkulationen, sodass für jede Zirkulation $z_i\in\mathscr{Z}$ der Graph $\bar{G}_{z_i}$ ein gerichteter Kreis ist, $z(e)=\sum_{i=1}^{n} z_i(e)$ für alle $e\in E(\bar{G})$ gilt und die Kosten $c(z)=\sum_{i=1}^{n} c(z_i)$ ebenfalls zerfallen.\end{lem}
\begin{proof}Sei $R_{N,f}= (\bar{G},\bar{f},b,\bar{c},\bar{u})$ ein Residualnetzwerk und $z$ eine Zirkulation. Wir führen eine Induktion über die Gesamtmenge des Flusses $\sigma_z:=\sum_{e\in E(\bar{G})}z(e)$ der Zirkulation durch. Ist $\sigma_z=0$, so erfüllt die leere Menge das Lemma.
    
Sei $\sigma_z\neq0$ und damit gemäß \cref{zirk} $\sigma_z>0$. Damit ist $\bar{G}_z$ nicht der leere Graph und nach \cref{zirkII} existiert ein gerichteter Kreis $C\subseteq \bar{G}_z$. Wir definieren eine Abbildung $z'$ wie folgt:
\begin{equation*}z'(e)=\begin{cases}
z(e)-1&\text{wenn }e\in E(C)\\
z(e)&\text{sonst}\end{cases}
\end{equation*}
Offensichtlich ist $z'$ eine Zirkulation und $\sigma_{z'}<\sigma_z$. Wir nehmen per Induktion an, dass wir für $z'$ eine Menge $\mathscr{Z}':=\{z'_1,\ldots,z'_n\}$ von Zirkulationen mit obigen Eigenschaften erhalten. \Obda sei $\bar{G}_{z'_i}\neq\bar{G}_{z'_j}$ für $i\neq j$, denn andernfalls können wir die beiden Zirkulationen vereinigen. Ist $C=\bar{G}_{z'_i}$ für eine Zirkulation $z'_i$, dann sei $\tilde{z}:=z'_i$, andernfalls sei $\tilde{z}$ die leere Zirkulation auf $\bar{G}$.

In beiden Fällen definieren wir die Zirkulation $z_{n+1}$ mit $z_{n+1}(e)=\tilde{z}(e)+1$ für alle $e\in E(C)$ und $z_{n+1}(e)=0$ sonst. Offensichtlich ist $\bar{G}_{z_{n+1}}=C$ ein gerichteter Kreis. Wir setzen $\mathscr{Z}:=\mathscr{Z}'\backslash\tilde{z}\cup z_{n+1}$, womit für $z$ und $\mathscr{Z}$ nach Konstruktion gilt:
\begin{align*}
\forall e\in E(\bar{G})\backslash E(C)\colon\quad &\sum_{\mathclap{z_i\in\mathscr{Z}}} z_i(e) = \sum_{\mathclap{z'_i\in\mathscr{Z'}}} z'_i(e) - \tilde{z}(e) + z_{n+1}(e)\\
=&\sum_{\mathclap{z'_i\in\mathscr{Z'}}} z'_i(e) - \tilde{z}(e) + \tilde{z}(e) = \sum_{\mathclap{z'_i\in\mathscr{Z'}}} z'_i(e) = z'(e) =z (e)\\
%
\forall e\in E(C)\colon\quad &\sum_{\mathclap{z_i\in\mathscr{Z}}} z_i(e) = \sum_{\mathclap{z'_i\in\mathscr{Z'}}} z'_i(e) - \tilde{z}(e) + z_{n+1}(e)\\
=&\sum_{\mathclap{z'_i\in\mathscr{Z'}}} z'_i(e) - \tilde{z}(e) + \tilde{z}(e) + 1 = \sum_{\mathclap{z'_i\in\mathscr{Z'}}} z'_i(e) + 1 = z'(e) + 1 = z(e)
\end{align*}
Für die Kosten gilt:
\begin{equation*}
\sum_{\mathclap{z_i\in\mathscr{Z}}} c(z_i) = \sum_{\mathclap{z'_i\in\mathscr{Z'}}} c(z'_i) - c(\tilde{z}) + c(z_{n+1}) = c(z') + c(C) = c(z)
\end{equation*}
Damit ist die Aussage für alle Zirkulationen gezeigt.\end{proof}

\begin{nota}Seien $f$ und $\hat{f}$ zwei maximale Flüsse auf einem Netzwerk $(G,b,c,u)$. Mit $\hat{f}-f$ sei die folgendermaßen auf dem Residualnetzwerk $R_{N,f}$ definierte Abbildung $z\colon E(\bar{G})\rightarrow\mathbb{N}_{\geq0}$ gemeint:
\begin{equation*}z(e)=\begin{cases}
\max\{\hat{f}(e)-f(e),0\}&\text{wenn } e\in E(G)\\
\max\{f(\varphi(e))-\hat{f}(\varphi(e)),0\}&\text{wenn } e\in \varphi(E(G))\end{cases}
\end{equation*}\end{nota}

\begin{lem}\label{f-f}Seien $f$ und $\hat{f}$ zwei maximale Flüsse auf einem Netzwerk $(G,b,c,u)$. Dann ist $z:=\hat{f}-f$ eine Zirkulation auf $R_{N,f}$ und für die Kosten gilt $c(z)=c(\hat{f})-c(f)$.\end{lem}
\begin{proof}Sei $E:=E(G)$ die Menge aller Kanten des Graphen und $\bar{E}:=\varphi(E)$ die Menge ihrer Residualkanten in $\bar{G}$. Zunächst überprüfen wir, ob $z$ alle Eigenschaften aus \cref{zirk} erfüllt. Für alle Kanten $e\in E$ ist
\begin{equation*}z(e)=\max\{\hat{f}(e)-f(e),0\}\leq\hat{f}(e)\leq u(e)=\bar{u}(e),\end{equation*}
für Residualkanten $\bar{e}\in \bar{E}$ gilt
\begin{equation*}z(\bar{e})=\max\{f(\varphi(\bar{e}))-\hat{f}(\varphi(\bar{e})),0\}\leq f(\varphi(\bar{e}))\leq u_f(\bar{e})\leq \bar{u}(e).\end{equation*}

\cref{zirkI} ist folglich gegeben. Es bleibt zu zeigen, dass sich der Fluss von $z$ für alle Knoten $v\in V(\bar{G})$ gemäß \cref{zirkII} ausgleicht:
\begin{align*}&\sum_{\mathclap{(w,v)\in E\amalg\bar{E}}} z((w,v)) - \sum_{\mathclap{(v,w)\in E\amalg\bar{E}}} z((v,w))\\
={}&\sum_{\mathclap{(w,v)\in E}} \Big(\hat{f}((w,v)) -  f((w,v))\Big) -  \sum_{\mathclap{(v,w)\in E}} \Big(\hat{f}((v,w)) - f((v,w))\Big)\\
={}&b(v)-b(v)=0\end{align*}

Die erste Gleichheit gilt gemäß Konstruktion von $z$, da ein theoretischer negativer Fluss auf einer Kante $e\in E(G)$ als positiver auf der Residualkante $\varphi(e)$ umgesetzt wird. Die zweite Umformung gilt gemäß \cref{DefMaxFlowII} aus \cref{DefMaxFlow}. Damit ist \cref{zirkII} erfüllt und $z$ eine Zirkulation. Zu guter Letzt betrachten wir die Kosten von $z$:
\begin{align*}c(z)&=\sum_{\mathclap{e\in E\amalg\bar{E}}} z(e)\cdot \bar{c}(e)\\
&=\sum_{e\in E}\max\{\hat{f}(e)-f(e),0\}\cdot c(e) + \sum_{\bar{e}\in \bar{E}}\max\{f(\varphi(\bar{e}))-\hat{f}(\varphi(\bar{e})),0\}\cdot c_f(\bar{e})\\
&=\sum_{e\in E}\max\{\hat{f}(e)-f(e),0\}\cdot c(e) + \sum_{\bar{e}\in \bar{E}}-\min\{\hat{f}(\varphi(\bar{e}))-f(\varphi(\bar{e})),0\}\cdot(- c(\varphi(\bar{e})))\\
&=\sum_{e\in E}\max\{\hat{f}(e)-f(e),0\}\cdot c(e) + \sum_{e\in E}\min\{\hat{f}(e)-f(e),0\}\cdot c(e)\\
&=\sum_{e\in E} (\hat{f}(e)-f(e))\cdot c(e) = c(\hat{f})-c(f)\qedhere
\end{align*}\end{proof}

Bevor wir nun \cref{opt} beweisen, zeigen wir noch, wie sich mithilfe einer Zirkulation der Beweis von \cref{TreeUnique} wesentlich vereinfachen lässt. 

\TreeUnique*
\begin{proof}Seien $(T,f)$ und $(T,f')$ zwei zulässige Baumlösungen zu demselben aufspannenden Baum $T$ des Netzwerkes $N=(G,b,c,u)$. Betrachte die Zirkulation $z:=f'-f$ auf $R_{N,f}$. Da $G_f\cup G_{f'}\subseteq T$ ein Wald ist, gilt dies auch für $\bar{G}_z$. Damit gilt $z(\bar{e}) = 0$ für alle Kanten $\bar{e}\in E(\bar{G})$, womit schon $f=f'$ war.\end{proof}

\Opt*
\begin{proof}Wir werden zeigen, dass ein negativer Kreis $\bar{C}_{T,e}$ existiert, falls die betrachtete zulässige Baumlösung $(T,f)$ nicht optimal ist. Dazu finden wir einen gerichteten negativen Kreis, auf den wir \cref{iterierbar} anwenden können.
	
Sei $N=(G,b,c,u)$ ein Netzwerk mit einer optimalen zulässigen Baumlösung $(\hat{T},\hat{f})$ und einer zulässigen Baumlösung $(T,f)$, sodass $c(f)>c(\hat{f})$. Dann ist $z:=\hat{f}-f$ eine Zirkulation und nach \cref{f-f} sind ihre Kosten $c(z)=c(\hat{f})-c(f)<0$ negativ. Des Weiteren zerfällt $z$ gemäß \cref{zerl} in eine Menge $\mathscr{Z}=\{z_1,\ldots,z_n\}$ von Zirkulationen, sodass $c(z)=\sum_{i=1}^{n} c(z_i)$ gilt und $\bar{G}_{z_i}$ für alle $z_i\in\mathscr{Z}$ ein gerichteter Kreis ist.  

Da $c(z)<0$ ist, gibt es mindestens eine Zirkulation $z_j\in\mathscr{Z}$ mit negativen Kosten. Sei $C_j:=\bar{G}_{z_j}$ der von ihr durchflossene Kreis und $e\in E(C_j)$ eine Kante davon. Ist $e$ eine Residualkante, so gilt $\hat{f}(\varphi(e))-f(\varphi(e))<0$, woraus $f(e)>0$ und damit $\varphi(e)\in E(T)$ folgt. Ansonsten ist $e\in E(G)$ und vom Algorithmus wählbar. Wir können also auf $C_j$ \cref{iterierbar} anwenden, das Theorem folgt.\end{proof}

\begin{kor}\label{korrekt}Sei $N$ eine Instanz des Transportproblems mit einer initialen zulässigen Baumlösung. Determiniert der Netzwerk-Simplex-Algorithmus, so ist er korrekt.\qed\end{kor}

Bislang haben wir nicht gezeigt, dass der Algorithmus immer terminiert. Dies wäre offensichtlich, wenn bei jeder Iteration von $(T,f)$ zu $(T',f')$ die Kosten sinken würden, also $c(f')<c(f)$ wäre. Es gibt jedoch sogenannte \emph{degenerierte Iterationen}, in denen ein negativer Kreis $\bar{C}_{T,e}$ um $\delta=0$ augmentiert wird. Entfernt der Algorithmus danach eine Kante $e'\in E(C_{T,e})\backslash\{e\}$, verändert sich nur der Baum. Im nächsten Abschnitt lernen wir einfache Methode kennen, durch die der Algorithmus immer terminiert.

\subsection{Degenerierte Iterationen}\label{ch:deg}

\begin{defn}Wird in einer Iteration der Phase 2 des Netzwerk-Simplex-Algorithmus ein negativer Kreis $\bar{C}_{T,e}$ um $\delta=0$ augmentiert, so bezeichnen wir diese als \textbf{degenerierte Iteration}.
\end{defn}

\begin{figure}[!ht]\centering
	\includestandalone{tikz_deg}
	\caption{Die Kanten des Baumes $T_i$ sind gestrichelt dargestellt, der gewählte negative Kreis ist jeweils eindeutig. Die Startlösung kann erst nach einer degenerierten Iteration verbessert werden.}
	\label{fig:deg}
\end{figure}

Degenerierte Iterationen entstehen, wenn bei einer zulässigen Baumlösung $(T,f)$ nicht alle Kanten von $T$ Fluss aufweisen, also $T\neq T_f$ gilt. $(T,f)$ wird dann auch als \emph{degeneriert} bezeichnet. In einer ungünstigen Konstellation der deterministischen Wahl der hinzugefügten Kante $e$ und entfernten Kante $e'$ kann es zum \emph{Cycling} kommen, also zu einer Abfolge von Bäumen, die wiederholt iteriert werden. Dies tritt sehr selten auf, für ein konstruiertes Beispiel siehe \cite[S. 303]{NSAbook}.

In \cite{cycling} führte Cunningham 1976 eine Methode ein, mit der durch eine geschickte Wahl der entfernten Kante Cycling verhindert werden kann, ohne dass die Auswahl der hinzufügbaren Kanten eingeschränkt wird. Dafür benötigen wir folgende Definitionen:

\begin{defn}Sei $N=(G,b,c,u)$ eine Instanz des Transportproblems. Ein aufspannender Baum $T$ von $G$, ein maximaler Fluss $f$ auf $N$ und ein Wurzelknoten $r\in V(T)=V(G)$ bilden eine \textbf{stark zulässige Baumlösung} $(T,f)_r$, falls $(T,f)$ eine zulässige Baumlösung ist und zusätzlich jede Kante $e=(v,w)\in E(T)$ mit $f(e)=0$ von der Wurzel wegführt, also $e$ im Weg $r\xrightarrow{T}w$ enthalten ist.\end{defn}

\begin{defn}Sei $N$ ein Netzwerk mit einer stark zulässigen Baumlösung $(T,f)_r$ und $e\in E(G)\backslash E(T)$ eine weitere Kante. Der \textbf{Apex} von $C_{T,e}$ ist der eindeutige Knoten $p\in V(C_{T,e})$, der den kürzesten Weg zu $r$ aufweist.\end{defn}

\begin{figure}[!ht]\centering
    \includestandalone{tikz_lastblockingarc}
    \caption{Grafik angelehnt an \cite[S. 372]{GNA}. Die gestrichelten Linien stellen den Baum $T$ mit Wurzelknoten $r$ dar. Die beiden blockierenden Kanten in $C_{T,e}$ sind rot gekennzeichnet, $p$ ist der Apex.}
    \label{fig:rule}
\end{figure}

Für einen Kreis $C_{T,e}$ bezeichnen wir diejenigen Kanten, die verhindern, dass der Kreis um mehr als $\delta$ augmentiert werden kann, als \emph{blockierende Kanten}. In \cref{fig:rule} ist $\delta=2$ und die blockierenden Kanten sind rot eingefärbt. Insbesondere wird die entfernte Kante immer unter diesen gewählt.

Die von Cunningham eingeführte \emph{Regel der letzten blockierenden Kante} besagt nun folgendes: Mit dem Apex von $C_{T,e}$ beginnend gehe über alle Kanten $e\in E(C_{T,e})$ in der durch $e$ bestimmten Orientierung des Kreises und wähle die letzte blockierende Kante als die zu entfernende Kante aus. In \cref{fig:rule} ist diese dementsprechend $e'$. Dank dieser Regel terminiert der Netzwerk-Simplex-Algorithmus nicht nur, er wird meistens sogar beschleunigt. 
 
\begin{lem}[\protect{\cite[S. 108\,f.]{cycling}}]
Wird eine stark zulässige Baumlösung $(T,f)_r$ um einen Kreis $\bar{C}_{T,e}$ größtmöglich augmentiert und eine Kante gemäß  der Regel der letzten blockierenden Kante entfernt, ist die entstehende Baumlösung $(T',f')$ wieder eine stark zulässige Baumlösung $(T',f')_r$.\qed\end{lem}

\begin{thm}[\protect{\cite[S. 108\,f.]{cycling}}]
Der Netzwerk-Simplex-Algorithmus mit einer initialen stark zulässigen Baumlösung, einem beliebigen Pivotalgorithmus und der Regel der letzten blockierenden Kante terminiert.\qed\end{thm}

TODO: Untenstehendes Kapitel aktualisieren, nachdem die anderen Kapitel geschrieben wurden.

Nach \cite[S. 359]{GNA} ist die Laufzeit des Netzwerk-Simplex-Algorithmus für bestimmte Pivotalgorithmen polynomiell in der Anzahl Knoten und Kanten sowie den höchsten Kosten einer Kante beschränkt. Für die in der Praxis verwendeten Pivotalgorithmen sind keine polynomiellen Schranken bekannt, teilweise wurden sogar exponentielle Instanzen gefunden, die auf \emph{Stalling} basieren, also einer exponentiellen Anzahl degenerierter Iterationen. Mit diesen werden wir uns in \cref{ch:lit} näher befassen. Meine eigene, experimentelle Suche nach schlechten Instanzen findet sich in \cref{ch:erg}. Zunächst vervollständigen wir den Algorithmus um die Wahl des negativen Kreises $\bar{C}_{T,e}$ und die Erzeugung einer initialen Baumlösung.

\subsection{Pivotalgorithmen}\label{ch:pivot}
Sei $N=(G,b,c,u)$ ein Netzwerk mit zulässiger Baumlösung $(T,f)$. Algorithmen, die aus der Menge $\bar{C}_T=\{\bar{C}_{T,e}\mid c(\bar{C}_{T,e})<0\}$ aller sinnvollen Iterationen eine auswählen, heißen \emph{Pivotalgorithmen}. In der Praxis wird der Pivotalgorithmus nur auf einer Teilmenge von $\bar{C}_T$ ausgeführt, um Rechenzeit zu sparen. In dieser Bachelorarbeit werden nur drei naheliegende, einfache Pivotalgorithmen betrachtet.

\subsubsection{Maximum Value}
Der erste Ansatz ist es, den negativsten Kreis zu wählen, sprich \begin{equation*}
\tilde{C}:=\argmin_{\bar{C}_{T,e}\in\bar{C}_T} \{c(\bar{C}_{T,e})\}
\end{equation*}

Diesen Weg werden wir mit \emph{MaxVal} bezeichnen.

\subsubsection{Maximum Revenue}
Die Kostenverringerung nach der Augmentierung beträgt $\delta_e\cdot c(\bar{C}_{T,e})$, ist also von $\delta_e$ abhängt. Der Pivotalgorithmus \emph{MaxRev} maximiert diesen Wert:
\begin{flalign*}
&&\tilde{C}:=\argmin_{\bar{C}_{T,e}\in\bar{C}_T} \{\delta_e\cdot c(\bar{C}_{T,e})\},
&&\text{wobei }\delta_e:=\min_{e'\in E(\bar{C}_{T,e})}\{\bar{u}(e')-\bar{f}(e')\}
\end{flalign*}

Nach \cref{negKreis} ist jedes $\delta_e$ endlich. Sollten nur degenerierte Iterationen zur Auswahl stehen, ist $c(\tilde{C})=0$. In dem Fall wendet meine konkrete Implementierung MaxVal an; hier sind aber auch andere Strategien denkbar.

\subsubsection{Random}
Ein überraschend effektiver Ansatz ist es, $\tilde{C}\in \bar{C}_T$ zufällig zu wählen. Gerade für diesen mit \emph{Random} bezeichneten Weg ist es schwierig, die erwartete Laufzeit zu bestimmen.

\subsection{Initialisierung} \label{ch:init}
Der letzte verbleibende Schritt, um einen vollständigen Algorithmus zur Lösung des Transportproblems zu erlangen, ist das Finden einer initialen, stark zulässigen Baumlösung $(T_0,f_0)_r$.

Hierfür wenden wir einen Trick an: Sei $N=(G,b,c,u)$ eine Instanz des Transportproblems. Wir fügen dem Netzwerk einen zusätzlichen Transitknoten $a$ mit $b(a)=0$ hinzu, der gemeinhin als künstlicher \textit{(artificial)} Knoten bezeichnet wird. Für alle Quellen $v\in V(G)\colon b(v)>0$ ergänzen wir eine künstliche Kante $(v,a)$, für alle Senken und Transitknoten $a\neq w\in V(G)\colon b(w)\leq0$ eine künstliche Kante $(a,w)$. Sei $G'$ der entstehende Graph.

Sämtliche künstlichen Kanten $e_v$ haben eine unbegrenzte Kapazität, die Kosten sind ebenfalls unendlich und können mit $c(e_v)=|V(G)|\cdot\max_{e\in E(G)}\{c(e)\}+1$ abgeschätzt werden, da jeder Weg in $G$ geringere Kosten aufweist. Leicht finden wir nun die stark zulässige Baumlösung $(T_0,f_0)_a$, wobei $T_0=(V(G),\{e_v\mid v\in V(G)\})$ ist. Nach \cref{TreeUnique} ist $f_0$ eindeutig. Diese Art der Initialisierung werden wir im Folgenden mit \emph{HC} für \emph{High-Cost-Initialisierung} abkürzen.

\begin{lem}Sei $N=(G,b,c,u)$ eine Instanz des Transportproblems und $(T',f)$ die Lösung des Netzwerk-Simplex-Algorithmus mit \emph{HC} auf dem erweiterten Graphen $G'$. Die Instanz $N$ ist genau dann lösbar, wenn $G'_f$ keine künstlichen Kanten enthält.\end{lem}
\begin{proof}\label{solvable}\mbox{}
\begin{itemize}[topsep=0pt]
	\item[\enquote{$\Rightarrow$}] Sei $\hat{f}$ ein maximaler Fluss von $N$ und $(T',f)$ die Lösung des Algorithmus. $\hat{f}$ ist auch ein maximaler Fluss des Netzwerkes $(G',b,c,u)$; damit gilt nach \cref{BLex} und \cref{korrekt} $c(f)\leq c(\hat{f})<\infty$. Da die Kosten einer künstlichen Kante unendlich sind, kann keine davon in $G'_f$ enthalten sein.
	
	\item[\enquote{$\Leftarrow$}] Sei $(T',f)$ die Lösung des Algorithmus. Wenn $G'_f$ keine künstlichen Kanten enthält, ist $f_{|E(G)}$ ein maximaler Fluss von $N$, womit diese Instanz wiederum lösbar ist.\qedhere
\end{itemize}
\end{proof}

Sollen Instanzen mit vielen Knoten oder hohen Kosten der teuersten Kante gelöst werden, so kann es passieren, dass die Kosten der künstlichen Kanten den darstellbaren Bereich der gängigen Datentypen sprengen. Unter anderem aus diesem Grund gibt es die \emph{Low-Cost-Initialisierung}, bei uns kurz \emph{LC}.

Bei dieser wird die gegebene Instanz $N=(G,b,c,u)$ des Transportproblems zunächst zu $N'=(G,b,c',u)$ abgewandelt. Dabei ist $c'$ die Nullfunktion, also $c(e)=0$ für jede Kante $e\in E(G)$. Für $N'$ verwenden wir den Netzwerk-Simplex-Algorithmus mit \emph{HC} und erhalten eine stark zulässige Baumlösung $(T',f')_a$, wobei die Kosten einer künstlichen Kante $c(e_v)=|V(G)|\cdot0+1=1$ betragen.

Offensichtlicherweise ist $N$ genau dann lösbar, wenn $N'$ lösbar ist. Wenn $c(f')>0$ ist, so ist $N$ nicht lösbar und wir sind fertig. Andernfalls iterieren wir $(T',f')_a$ degeneriert, bis $a$ ein Blatt von $T'$ ist. Dies wird in \cref{ch:HCLC} detailliert erläutert.

Damit bekommen wir die zulässige Baumlösung $(T=T'-a, f=f'_{|E(G)})$ für $N'$ und damit für $N$. Als neuen Wurzelknoten können wir den eindeutigen Nachbar $k_a$ von $a$ in $T'$ wählen; damit bekommen wir die stark zulässige Baumlösung $(T,f)_{k_a}$. Nun kann eine optimale Lösung des Transportproblems für $N$ berechnet werden.

\section{Erweiterung auf beschränkte Kapazitäten}\label{ch:alg2}
Bisher haben wir uns auf unbeschränkte Kapazitäten beschränkt. Wir werden nun den Netzwerk-Simplex-Algorithmus auf das allgemeinere Min-Cost-Flow-Problem erweitern. Die Funktionsweise bleibt dieselbe, nur die betrachteten zulässigen Baumlösungen verändern sich leicht:

\begin{defn}Sei $N=(G,b,c,u)$ ein Netzwerk. Ein aufspannender Baum $T$ von $G$ und ein maximaler Fluss $f$ auf $N$ bilden eine \textbf{zulässige Baumlösung} $(T,f)$, wenn für alle Kanten $e\in E(G)\backslash E(T)$ außerhalb des Baums $f(e) = 0$ oder $f(e)=u(e)$ gilt.\end{defn}
\begin{anm}Kanten, die maximal durchflossen sind, bezeichnen wir als \emph{saturiert}.\end{anm}

\begin{defn}Sei $N=(G,b,c,u)$ ein Netzwerk. Ein aufspannender Baum $T$ von $G$, ein maximaler Fluss $f$ auf $N$ und ein Wurzelknoten $r\in V(T)=V(G)$ bilden eine \textbf{stark zulässige Baumlösung} $(T,f)_r$, wenn $(T,f)$ eine zulässige Baumlösung ist und folgendes gilt:
\begin{alignat*}{2}
\forall e=(v,w)\in E(T)\colon\quad&(f(e)=0 \Rightarrow e\in E(r\xrightarrow{T}w))&\land\\
&(f(e)=u(e) \Rightarrow e\in E(w\xrightarrow{T}r))
\end{alignat*}\end{defn}
\begin{anm}An dieser Stelle sollten sämtliche Kanten $e\in E(G)$ mit $u(e)=0$ aus dem Graphen entfernt werden; sie sind für das Problem ohnehin irrelevant.\end{anm}

\begin{figure}[!ht]\centering
	\includestandalone{tikz_NSA}	
	\caption{Derselbe, durch gestrichelte Linien dargestellte Baum mit unterschiedlichen maximalen Flüssen. Der Wurzelknoten ist die Senke.}
	\label{fig:NSA}
\end{figure}

Im Falle beschränkter Kapazitäten erlauben wir für eine zulässige Baumlösung $(T,f)$ auch Fluss außerhalb von $T$, insofern er die Kapazität der Kante voll ausnutzt. \cref{fig:NSA} veranschaulicht, warum dies notwendig ist. Solche saturierten Kanten $e\in E(G)\backslash E(T)$ sind als eingehende Kante keine sinnvolle Wahl mehr, stattdessen kann der Algorithmus über den Kreis $\bar{C}_{T,\bar{e}}$ der Residualkante $\bar{e}$ augmentieren, sofern er negativ ist. Für stark zulässige Baumlösungen müssen nun zusätzlich alle saturierten Kanten des Baumes zum Wurzelknoten hinführen.

\cref{fig:NSA} veranschaulicht, dass die in \cref{TreeUnique} bewiesene Eindeutigkeit von $f$ nun nicht mehr gilt. Wir haben diese Eigenschaft bei der Initialisierung genutzt. Der Leser kann sich an dieser Stelle davon überzeugen, dass diese trotzdem komplett identisch durchführbar ist.

Die in \cref{ch:deg} beschriebene Regel der letzten blockierenden Kante wurde in \cite{cycling} ohnehin für den allgemeinen Fall eingeführt und lässt sich einfach übertragen. Wir werden jetzt \cref{negKreis,BLex,opt,TP} auf das Min-Cost-Flow-Problem erweitern.

\begin{lem}\label{negKreis2}Sei $N$ ein Netzwerk, $R_{N,f}$ sein Residualnetzwerk und $C$ ein gerichteter Kreis im Residualgraph $\bar{G}$ mit negativen Kosten. Dann ist der größte Wert $\delta$, um den $C$ augmentiert werden kann, endlich, und nach der Augmentierung um $\delta$ zum neuen maximalen Fluss $f'$ existiert eine Residualkante $\bar{e}\in E(C)$, sodass die korrespondierende Kante einen Fluss von $f'(\varphi(e))=0$ besitzt, oder eine Kante $e\in E(C)\cap E(G)$ mit $f'(e)=u(e)$.\end{lem}
\begin{proof}Sei $N=(G,b,c,u)$ ein Netzwerk mit maximalen Fluss $f$ und $C$ ein negativer Kreis in $\bar{G}$. Sei $\tilde{e}:=\argmin_{e\in E(C)}\{\bar{u}(e)-\bar{f}(e)\}$ und $\delta:=\bar{u}(\tilde{e})-\bar{f}(\tilde{e})$. Analog zum Beweis von \cref{negKreis} ist $\delta$ endlich.
	
Ist $\tilde{e}$ eine Residualkante, so besitzt $e:=\varphi(e)$ einen Fluss von
\begin{equation*}
f'(e)=f(e)-\delta=f(e)-u_f(\bar{e})=f(e)-f(e)=0.\end{equation*} Andernfalls ist $\tilde{e}\in E(C)\cap E(G)$ mit einem Fluss von
\begin{equation*}
f'(\tilde{e})=f(\tilde{e})+\delta=f(\tilde{e})+\bar{u}(\tilde{e})-\bar{f}(\tilde{e})=\bar{u}(\tilde{e})=u(\tilde{e}).\qedhere\end{equation*}\end{proof}

\begin{nota}Sei $f$ ein maximaler Fluss für ein Netzwerk $(G=(V,E),b,c,u)$ und $H=(V'\subseteq V, E'\subseteq E)$ ein Teilgraph. Mit $H^f=H_f\backslash\{e\in E'\mid f(e)=u(e)\}$ bezeichnen wir den Graph aller durchflossenen, aber nicht saturierten Kanten.\end{nota}

\begin{thm}\label{BLex2}Sei $N$ ein Netzwerk mit einem maximalen Fluss $f$. Es existiert ein maximaler Fluss $\hat{f}$, sodass $c(\hat{f})\leq c(f)$ ist und eine zulässige Baumlösung $(\hat{T},\hat{f})$ existiert.\end{thm}
\begin{proof}Sei $N=(G,b,c,u)$ ein Netzwerk mit maximalen Fluss $f$. Diesmal werden wir $f$ zu einem maximalen Fluss $\hat{f}$ umwandeln, sodass $G^{\hat{f}}$ ein Wald ist. Der Beweis verläuft nun komplett analog zum Beweis von \cref{BLex}, statt \cref{negKreis} benutzen wir \cref{negKreis2}.\end{proof}

\begin{kor}Für jede lösbare Instanz des Min-Cost-Flow-Problems existiert eine zulässige Baumlösung $(T,f)$, sodass der maximale Fluss $f$ minimale Kosten hat.\qed\end{kor}

\begin{thm}\label{opt2}Sei $N$ ein Netzwerk mit einer zulässigen Baumlösung $(T,f)$. Existiert kein negativer Kreis $\bar{C}_{T,e}$, so ist $f$ eine optimale Lösung.\end{thm}
\begin{proof}Wir werden wiederum zeigen, dass ein negativer Kreis $\bar{C}_{T,e}$ existiert, wenn die betrachtete Baumlösung nicht optimal ist.

Sei $N=(G,b,c,u)$ ein Netzwerk mit einer optimalen zulässigen Baumlösung $(\hat{T},\hat{f})$ und einer zulässigen Baumlösung $(T,f)$, sodass $c(f)>c(\hat{f})$ ist. Wieder betrachten wir die Zirkulation $z:=\hat{f}-f$, ihre Zerlegung gemäß \cref{zerl} in eine Menge $\mathscr{Z}$ von Zirkulationen über gerichteten Kreisen und eine Zirkulation $z_j\in\mathscr{Z}$ mit negativen Kosten sowie den ihr zugehörigen negativen Kreis $C_j=\bar{G}_{z_j}$.

Sei $e\in E(C_j)$ eine Kante dieses Kreises. Ist $e$ eine Residualkante, so gilt wie gehabt $\hat{f}(\varphi(e))-f(\varphi(e))<0$, woraus $f(e)>0$ folgt. Damit ist $\varphi(e)\in E(T)$ oder $\varphi(e)$ saturiert. Andernfalls ist $e\in E(G)$ und $f(e)<\hat{f}(e)$, womit $e$ nicht saturiert sein kann. Die Bedingungen für \cref{iterierbar} sind erneut gegeben.\end{proof}

\begin{kor}Der Netzwerk-Simplex-Algorithmus mit einer Initialisierung nach \cref{ch:init}, einem beliebigen Pivotalgorithmus und gemäß \cref{ch:deg} auf stark zulässige Baumlösungen beschränkt löst das Min-Cost-Flow-Problem korrekt.\qed\end{kor}